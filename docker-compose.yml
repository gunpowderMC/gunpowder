version: '2.1'
services:
  mongod:
    image: mongo
    volumes:
     - ./db:/data/db
  gunpowder:
    depends_on:
       - mongod
    build: .
    ports:
     - "25566:25565"
     - "25566:25565/udp"
    volumes:
     - ./:/app
    environment:
     - "VIRTUAL_HOST=${HOST:-localhost}"
     - VIRTUAL_PORT=8080
     - "LETSENCRYPT_HOST=${HOST:-localhost}"
     - "LETSENCRYPT_EMAIL=${EMAIL:-null@null.net}"

  nginx-proxy:
    volumes:
     - ./data/certs:/etc/nginx/certs:ro
     - /etc/nginx/vhost.d
     - /usr/share/nginx/html

     - /var/run/docker.sock:/tmp/docker.sock:ro
    image: jwilder/nginx-proxy
    ports:
     - 80:80
     - 443:443

  letsencrypt-nginx-proxy-companion:
    image: jrcs/letsencrypt-nginx-proxy-companion
    volumes_from:
     - nginx-proxy
    volumes:
     - ./data/certs:/etc/nginx/certs:rw

     - /var/run/docker.sock:/var/run/docker.sock:ro